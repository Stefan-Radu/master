#!/usr/bin/env python3

from pwn import *
from itertools import permutations

# payload = b'zihldazjcnvlrgmhasbwjqvanafylzhhqtjylumfyemlopqosjmdcdyamgecnhnewfhetk'
# for i in range(7):
    # print(payload[i * 10: (i + 1) * 10])

# payload length 70 from bash script
cribs = [b'zihldazjcn', b'vlrgmhasbw', b'jqvanafylz', b'hhqtjylumf', \
         b'yemlopqosj', b'mdcdyamgec', b'nhnewfhetk']

# Set logging level to ERROR
context.log_level = 'error'

with open("flags.txt", "bw") as f:
    for i, perm in enumerate(permutations(cribs)):
        if i % 100 == 0:
            print(i)

        payload = b''.join(perm)
        # exit(0)
        # p = process(["ltrace", './crackme'])
        p = process('./crackme')
        p.sendline(payload)

        l = p.recvuntil(b'If all you see is garbage, try a different one\n')
        l = p.recvall(timeout=0.5)
        f.write(l)

        try:
            # if the text is printable, it should be decodable
            s = l.decode()
            print(f'found flag {s}with payload {payload.decode()}')
        except:
            pass

        p.kill()
